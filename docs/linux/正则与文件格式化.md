# 正则与文件格式化

## 正则
> 正则是一个字符串处理的标准依据。若要以正则表示法的方式处理字符串，就要使用支持正则表示法的工具程序，如：vi，grep， sed， awk等

### 语系对正则表示法的影响
- LANG=C 时：0 1 2 3 4 ... A B C D ... a b c d ...z
- LANG=zh_TW时： 0 1 2 3 4 ... a A b B c C ...z Z
使用正则表达式，需要特别留意当时环境的语系，否则可能会发现与别人的结果不相同。通常情况下使用的是兼容于POSIX的标准，因此就是使用 C 这个语系。

|特殊符号|代表意义|
|---|---|
|[:alnum:]|代表英文大小写字符及数字，即0-9 A-Z a-z|
|[:alpha:]|代表任何英文大小写字符，即A-Z，a-z|
|[:blank:]|代表空格键与 tab |
|[:cntrl:]|代表键盘上面的控制按键，即 CR，LF，Tab，Del 等|
|[:digit:]|代表数字，即0-9|
|[:graph:]|除了空格符 tab 外的其他所有按键|
|[:lower:]|代表小写符，即a-z|
|[:print:]|代表任何可以被打印出来的字符|
|[:punct:]|代表标点符号，即"'?!;:#$...|
|[:upper:]|代表大写字符，即A-Z|
|[:space:]|任何会产生空白的字符，包括空格键 tab CR 等|
|[:xdigit:]|代表16进制的数字类型，0-9， a-f， A-F的数字与字符|

demsg
|选项|参数|
|---|---|
|-A| 后面可接数字，为after的意思，除了列出该行外，后续的n行也列出来|
|-B| 后面可接数字，为before的意思，除了列出改行外，前面的n行也列出来|
|--color=auto|可将正确的那个撷取数据显示出颜色|

```shell
# dmesg 显示出核心信息
[az@iZbp13op1xah7j3j1x457dZ bin]$ dmesg | grep 'XFS'
[3453874.290904] SGI XFS with ACLs, security attributes, no debug enabled
[3453874.293188] XFS (loop0): Mounting V5 Filesystem
[3453874.635609] XFS (loop0): Ending clean mount
[3454148.892624] XFS (loop0): Unmounting Filesystem
[az@iZbp13op1xah7j3j1x457dZ bin]$

[az@iZbp13op1xah7j3j1x457dZ bin]$ dmesg | grep -n --color=auto 'XFS'
2921:[3453874.290904] SGI XFS with ACLs, security attributes, no debug enabled
2922:[3453874.293188] XFS (loop0): Mounting V5 Filesystem
2923:[3453874.635609] XFS (loop0): Ending clean mount
2924:[3454148.892624] XFS (loop0): Unmounting Filesystem
[az@iZbp13op1xah7j3j1x457dZ bin]$

[az@iZbp13op1xah7j3j1x457dZ bin]$ dmesg | grep -n -A3 -B2 --color=auto 'XFS'
2919-[ 4917.531676] Killed process 3165 (ruby), UID 995, total-vm:1043568kB, anon-rss:583624kB, file-rss:0kB, shmem-rss:720kB
2920-[3453874.208049] loop: module loaded
2921:[3453874.290904] SGI XFS with ACLs, security attributes, no debug enabled
2922:[3453874.293188] XFS (loop0): Mounting V5 Filesystem
2923:[3453874.635609] XFS (loop0): Ending clean mount
2924:[3454148.892624] XFS (loop0): Unmounting Filesystem
[az@iZbp13op1xah7j3j1x457dZ bin]$ 
```

### 基础连续
```shell
"Open Source" is good mechanism to develop programs.
apple is my favorite food.
Football game is not use feet only.
this dress doesn`t fit me.
Howwver, this dress is about $ 3183 dollars.^M
GUN is free air not free beer.^M
Her hair is very beauty.^M
I can`t finish the test.^M
Oh! The soup taste good.^M
motorcycle is cheap than car.
This window is clear.
this symbol '*' is represented as star1.
Oh! My god!
The gd software is a library for drafting programs.^M
Your are the best is mean you are the no. 1.
The world <Happy> is the same with "glad".
I like dog.
google is the best tools for search keyword.
goooooogle yes!
go! go! Let`s go.
# I am AZ

```
- 查找特定字符串
```shell
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'the' regular_express.txt 
8:I can`t finish the test.^M
15:Your are the best is mean you are the no. 1.
16:The world <Happy> is the same with "glad".
18:google is the best tools for search keyword.
[az@iZbp13op1xah7j3j1x457dZ ~]$

# 反向选择
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -vn 'the' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
2:apple is my favorite food.
3:Football game is not use feet only.
4:this dress doesn`t fit me.
5:Howwver, this dress is about $ 3183 dollars.^M
6:GUN is free air not free beer.^M
7:Her hair is very beauty.^M
9:Oh! The soup taste good.^M
10:motorcycle is cheap than car.
11:This window is clear.
12:this symbol '*' is represented as star1.
13:Oh! My god!
14:The gd software is a library for drafting programs.^M
17:I like dog.
19:goooooogle yes!
20:go! go! Let`s go.
21:# I am AZ
22:
[az@iZbp13op1xah7j3j1x457dZ ~]$

# 忽略大小写
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -in 'the' regular_express.txt 
8:I can`t finish the test.^M
9:Oh! The soup taste good.^M
14:The gd software is a library for drafting programs.^M
15:Your are the best is mean you are the no. 1.
16:The world <Happy> is the same with "glad".
18:google is the best tools for search keyword.
[az@iZbp13op1xah7j3j1x457dZ ~]$ 
```
- 利用[]来查找集合字符

```shell
# 查找test 或 taste []里面不论有几个字符，他都代表某一个字符
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 't[ae]st' regular_express.txt 
8:I can`t finish the test.^M
9:Oh! The soup taste good.^M
[az@iZbp13op1xah7j3j1x457dZ ~]$

# 查找有 oo 的字符
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'oo' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
2:apple is my favorite food.
3:Football game is not use feet only.
9:Oh! The soup taste good.^M
18:google is the best tools for search keyword.
19:goooooogle yes!
[az@iZbp13op1xah7j3j1x457dZ ~]$ 

# 查找oo并且前面没有g
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '[^g]oo' regular_express.txt 
2:apple is my favorite food.
3:Football game is not use feet only.
18:google is the best tools for search keyword.
19:goooooogle yes!
[az@iZbp13op1xah7j3j1x457dZ ~]$
# 因为gooooogle里面的oo前面可能是o，如go(oo)ooogle

# 查找oo前面不是小写字符
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '[^a-z]oo' regular_express.txt 
3:Football game is not use feet only.
[az@iZbp13op1xah7j3j1x457dZ ~]$

# 查找数字
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '[0-9]' regular_express.txt 
5:Howwver, this dress is about $ 3183 dollars.^M
12:this symbol '*' is represented as star1.
15:Your are the best is mean you are the no. 1.
[az@iZbp13op1xah7j3j1x457dZ ~]$ 

# 语系对编码顺序的影响， 除了连续编码使用 - 之外， 可以使用如下的方法
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '[^[:lower:]]oo' regular_express.txt 
3:Football game is not use feet only.
[az@iZbp13op1xah7j3j1x457dZ ~]$

[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '[[:digit:]]' regular_express.txt 
5:Howwver, this dress is about $ 3183 dollars.^M
12:this symbol '*' is represented as star1.
15:Your are the best is mean you are the no. 1.
[az@iZbp13op1xah7j3j1x457dZ ~]$ 

```
- 行首与行尾字符 ^ $
```shell
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '^the' regular_express.txt 
12:the symbol '*' is represented as star1.
[az@iZbp13op1xah7j3j1x457dZ ~]$

[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '^[a-z]' regular_express.txt 
2:apple is my favorite food.
4:this dress doesn`t fit me.
10:motorcycle is cheap than car.
12:the symbol '*' is represented as star1.
18:google is the best tools for search keyword.
19:goooooogle yes!
20:go! go! Let`s go.
[az@iZbp13op1xah7j3j1x457dZ ~]$

[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '^[[:lower:]]' regular_express.txt 
2:apple is my favorite food.
4:this dress doesn`t fit me.
10:motorcycle is cheap than car.
12:the symbol '*' is represented as star1.
18:google is the best tools for search keyword.
19:goooooogle yes!
20:go! go! Let`s go.
[az@iZbp13op1xah7j3j1x457dZ ~]$


[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '^[^a-zA-Z]' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
21:# I am AZ
[az@iZbp13op1xah7j3j1x457dZ ~]$


[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '\.$' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
2:apple is my favorite food.
3:Football game is not use feet only.
4:this dress doesn`t fit me.
10:motorcycle is cheap than car.
11:This window is clear.
12:the symbol '*' is represented as star1.
15:Your are the best is mean you are the no. 1.
16:The world <Happy> is the same with "glad".
17:I like dog.
18:google is the best tools for search keyword.
20:go! go! Let`s go.
[az@iZbp13op1xah7j3j1x457dZ ~]$

# 在Linux 与 windows上的差异， windows的断行字符（^M$），而正常的Linux中是$
[az@iZbp13op1xah7j3j1x457dZ ~]$ cat -An regular_express.txt | head -n 10 | tail -n 6
     5  Howwver, this dress is about $ 3183 dollars.^M$
     6  GUN is free air not free beer.^M$
     7  Her hair is very beauty.^M$
     8  I can`t finish the test.^M$
     9  Oh! The soup taste good.^M$
    10  motorcycle is cheap than car.$
[az@iZbp13op1xah7j3j1x457dZ ~]$

# 查找空白行
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '^$' regular_express.txt 
22:
[az@iZbp13op1xah7j3j1x457dZ ~]$



[az@iZbp13op1xah7j3j1x457dZ ~]$ cat -n /etc/rsyslog.conf
     1  # rsyslog configuration file
     2
     3  # For more information see /usr/share/doc/rsyslog-*/rsyslog_conf.html
     4  # If you experience problems, see http://www.rsyslog.com/doc/troubleshoot.html
     5
     6  #### MODULES ####
     7
     8  # The imjournal module bellow is now used as a message source instead of imuxsock.
     9  $ModLoad imuxsock # provides support for local system logging (e.g. via logger command)
    10  $ModLoad imjournal # provides access to the systemd journal
    11  #$ModLoad imklog # reads kernel messages (the same are read from journald)
    12  #$ModLoad immark  # provides --MARK-- message capability
    13
    14  # Provides UDP syslog reception
    15  #$ModLoad imudp
    16  #$UDPServerRun 514
    17
    18  # Provides TCP syslog reception
    19  #$ModLoad imtcp
    20  #$InputTCPServerRun 514
    21
    22
    23  #### GLOBAL DIRECTIVES ####
    24
    25  # Where to place auxiliary files
    26  $WorkDirectory /var/lib/rsyslog
    27
    28  # Use default timestamp format
    29  $ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat
    30
    31  # File syncing capability is disabled by default. This feature is usually not required,
    32  # not useful and an extreme performance hit
    33  #$ActionFileEnableSync on
    34
    35  # Include all config files in /etc/rsyslog.d/
    36  $IncludeConfig /etc/rsyslog.d/*.conf
    37
    38  # Turn off message reception via local log socket;
    39  # local messages are retrieved through imjournal now.
    40  $OmitLocalLogging on
    41
    42  # File to store the position in the journal
    43  $IMJournalStateFile imjournal.state
    44
    45
    46  #### RULES ####
    47
    48  # Log all kernel messages to the console.
    49  # Logging much else clutters up the screen.
    50  #kern.*                                                 /dev/console
    51
    52  # Log anything (except mail) of level info or higher.
    53  # Don't log private authentication messages!
    54  *.info;mail.none;authpriv.none;cron.none                /var/log/messages
    55
    56  # The authpriv file has restricted access.
    57  authpriv.*                                              /var/log/secure
    58
    59  # Log all the mail messages in one place.
    60  mail.*                                                  -/var/log/maillog
    61
    62
    63  # Log cron stuff
    64  cron.*                                                  /var/log/cron
    65
    66  # Everybody gets emergency messages
    67  *.emerg                                                 :omusrmsg:*
    68
    69  # Save news errors of level crit and higher in a special file.
    70  uucp,news.crit                                          /var/log/spooler
    71
    72  # Save boot messages also to boot.log
    73  local7.*                                                /var/log/boot.log
    74
    75
    76  # ### begin forwarding rule ###
    77  # The statement between the begin ... end define a SINGLE forwarding
    78  # rule. They belong together, do NOT split them. If you create multiple
    79  # forwarding rules, duplicate the whole block!
    80  # Remote Logging (we use TCP for reliable delivery)
    81  #
    82  # An on-disk queue is created for this action. If the remote host is
    83  # down, messages are spooled to disk and sent when it is up again.
    84  #$ActionQueueFileName fwdRule1 # unique name prefix for spool files
    85  #$ActionQueueMaxDiskSpace 1g   # 1gb space limit (use as much as possible)
    86  #$ActionQueueSaveOnShutdown on # save messages to disk on shutdown
    87  #$ActionQueueType LinkedList   # run asynchronously
    88  #$ActionResumeRetryCount -1    # infinite retries if host is down
    89  # remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional
    90  #*.* @@remote-host:514
    91  # ### end of the forwarding rule ###
[az@iZbp13op1xah7j3j1x457dZ ~]$


# 除去空白行 不要#开头的行
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -v '^$' /etc/rsyslog.conf | grep -v '^#'
$ModLoad imuxsock # provides support for local system logging (e.g. via logger command)
$ModLoad imjournal # provides access to the systemd journal
$WorkDirectory /var/lib/rsyslog
$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat
$IncludeConfig /etc/rsyslog.d/*.conf
$OmitLocalLogging on
$IMJournalStateFile imjournal.state
*.info;mail.none;authpriv.none;cron.none                /var/log/messages
authpriv.*                                              /var/log/secure
mail.*                                                  -/var/log/maillog
cron.*                                                  /var/log/cron
*.emerg                                                 :omusrmsg:*
uucp,news.crit                                          /var/log/spooler
local7.*                                                /var/log/boot.log
[az@iZbp13op1xah7j3j1x457dZ ~]$ 

```

- 任意一个字符 . 与重复字符 *
  . : 代表 一定有一个任意字符 的意思
  * : 代表 重复前一个字符， 0 到无穷多次 的意思， 为组合形态
```shell
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'g.d' regular_express.txt 
13:Oh! My god!
[az@iZbp13op1xah7j3j1x457dZ ~]$

[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'g..d' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
9:Oh! The soup taste good.^M
16:The world <Happy> is the same with "glad".
[az@iZbp13op1xah7j3j1x457dZ ~]$

# 重复o 0个或无穷多个
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'o*' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
2:apple is my favorite food.
3:Football game is not use feet only.
4:this dress doesn`t fit me.
5:Howwver, this dress is about $ 3183 dollars.^M
6:GUN is free air not free beer.^M
7:Her hair is very beauty.^M
8:I can`t finish the test.^M
9:Oh! The soup taste good.^M
10:motorcycle is cheap than car.
11:This window is clear.
12:the symbol '*' is represented as star1.
13:Oh! My god!
14:The gd software is a library for drafting programs.^M
15:Your are the best is mean you are the no. 1.
16:The world <Happy> is the same with "glad".
17:I like dog.
18:google is the best tools for search keyword.
19:goooooogle yes!
20:go! go! Let`s go.
21:# I am AZ
22:
[az@iZbp13op1xah7j3j1x457dZ ~]$ 

# 第一个必须是o 后面可以是0个或无穷多个
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'oo*' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
2:apple is my favorite food.
3:Football game is not use feet only.
4:this dress doesn`t fit me.
5:Howwver, this dress is about $ 3183 dollars.^M
6:GUN is free air not free beer.^M
9:Oh! The soup taste good.^M
10:motorcycle is cheap than car.
11:This window is clear.
12:the symbol '*' is represented as star1.
13:Oh! My god!
14:The gd software is a library for drafting programs.^M
15:Your are the best is mean you are the no. 1.
16:The world <Happy> is the same with "glad".
17:I like dog.
18:google is the best tools for search keyword.
19:goooooogle yes!
20:go! go! Let`s go.
[az@iZbp13op1xah7j3j1x457dZ ~]$

# 必须是oo 后面可以是0个或无穷多个o
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'ooo*' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
2:apple is my favorite food.
3:Football game is not use feet only.
9:Oh! The soup taste good.^M
18:google is the best tools for search keyword.
19:goooooogle yes!
[az@iZbp13op1xah7j3j1x457dZ ~]$ 

# 字符串开头是g 结尾是g，且两个g之前至少有一个o
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'goo*g' regular_express.txt 
18:google is the best tools for search keyword.
19:goooooogle yes!
[az@iZbp13op1xah7j3j1x457dZ ~]$

# 开头g与结尾g，当中的字符可有可无 .* 表示零个或任意多个字符
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'g.*g' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
14:The gd software is a library for drafting programs.^M
18:google is the best tools for search keyword.
19:goooooogle yes!
20:go! go! Let`s go.
[az@iZbp13op1xah7j3j1x457dZ ~]$


# 任意数字
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n '[0-9][0-9]*' regular_express.txt 
5:Howwver, this dress is about $ 3183 dollars.^M
12:the symbol '*' is represented as star1.
15:Your are the best is mean you are the no. 1.
[az@iZbp13op1xah7j3j1x457dZ ~]$ 
```

- 限定连续RE字符范围 ｛｝
```shell
# 这个和 grep -n 'ooo*' reqular_express.txt 一样
[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'o\{2\}' regular_express.txt 
1:"Open Source" is good mechanism to develop programs.
2:apple is my favorite food.
3:Football game is not use feet only.
9:Oh! The soup taste good.^M
18:google is the best tools for search keyword.
19:goooooogle yes!
[az@iZbp13op1xah7j3j1x457dZ ~]$ 


[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'go\{2,5\}g' regular_express.txt 
18:google is the best tools for search keyword.
[az@iZbp13op1xah7j3j1x457dZ ~]$

[az@iZbp13op1xah7j3j1x457dZ ~]$ grep -n 'go\{2,\}g' regular_express.txt 
18:google is the best tools for search keyword.
19:goooooogle yes!
[az@iZbp13op1xah7j3j1x457dZ ~]$ 
```

### 基础正则表示字符
|RE字符|意义与范例|
|---|---|
|^word|查找word在行首<br> 查找行首为#的那一行，且显示出行号<br> grep -n '^#' regular_express.txt|
|word$|查找word在行尾<br> 查找行尾为!的那一行，且显示出行号<br> grep -n '!$' regular_express.txt|
|.|一定有一个任意字符<br> 查找的字符串可以是（eve）（eae）（eee）（e e），但不能仅有（ee）<br> grep -n 'e.e' regular_express.txt|
|\|跳脱字符<br> 查找含有单引号 ' 的那一行<br> grep -n \' regular_express.txt|
|*|重复零个或无穷多个前一个RE字符<br>查找含有（es）（ess）（esss）等的字符串<br> grep -n 'ess*' regular_express.txt|
|[list]|字符集合RE字符，里面列出想要撷取的字符<br>查找含有（gl）或（gd）的那一行<br>grep -n 'g[ld]' regular_express.txt|
|[n1-n2]|字符集合的RE字符，里面列出想要撷取的字符<br>grep -n '[A-Z]' regular_express.txt|
|^list|字符集合的RE字符，里面列出不要的字符或范围<br>不包含oot的那一行<br>grep -n 'oo[^t]' regular_express.txt|
